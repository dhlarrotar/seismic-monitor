<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title id="app-title">
   Seismic Monitor &amp; Dashboard
  </title>
  <!-- FAVICON (Activity/Pulse Icon) -->
  <link href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236366F1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='lucide lucide-activity'%3E%3Cpath d='M22 12h-4l-3 9L9 3l-3 9H2'/%3E%3C/svg%3E" rel="icon" type="image/svg+xml"/>
  <!-- 1. Leaflet CSS -->
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
   <!-- 2. Custom Styles -->
  </link>
  <link href="style.css" rel="stylesheet"/>
 </head>
 <body class="bg-gray-900 text-white">
  <!-- LOADING OVERLAY -->
  <div id="app-loader">
   <div class="flex items-center space-x-2">
    <div class="loader-dot">
    </div>
    <div class="loader-dot">
    </div>
    <div class="loader-dot">
    </div>
   </div>
  </div>
  <div id="app-container">
   <!-- HEADER -->
   <header class="py-2 px-4 bg-gray-900 border-b border-gray-700 z-50 flex-shrink-0">
    <div class="flex flex-col container mx-auto max-w-7xl space-y-2">
     <!-- Row 1 -->
     <div class="flex items-center justify-between space-x-4">
      <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-1 sm:space-y-0 sm:space-x-4 min-w-0">
       <h1 class="text-xl sm:text-2xl font-bold text-white flex items-center space-x-2" id="header-title">
        <i class="h-6 w-6 text-indigo-400" data-lucide="activity">
        </i>
        <span>
         Seismic Monitor
        </span>
       </h1>
       <span class="flex items-center space-x-2 text-sm text-gray-400" id="loading-status">
       </span>
      </div>
      <!-- Header Actions -->
      <div class="header-actions">
       <!-- Settings Button -->
       <div class="settings-container">
        <button class="settings-btn" id="settings-btn">
         <i class="h-4 w-4" data-lucide="settings">
         </i>
         Settings
        </button>
        <div class="settings-popup" id="settings-popup">
         <div class="mb-3">
          <label class="text-xs text-gray-400 mb-1 block">
           Language
          </label>
          <select class="app-control w-full" id="lang-select">
           <option selected="" value="en">
            English
           </option>
           <option value="es">
            Español
           </option>
          </select>
         </div>
         <div>
          <label class="text-xs text-gray-400 mb-1 block">
           Basemap
          </label>
          <div class="flex flex-col space-y-2">
           <div class="basemap-option active" data-value="dark">
            <div class="basemap-preview basemap-dark">
            </div>
            <span>
             Dark
            </span>
           </div>
           <div class="basemap-option" data-value="standard">
            <div class="basemap-preview basemap-light">
            </div>
            <span>
             Light
            </span>
           </div>
           <div class="mt-3 px-2">
            <label class="text-xs text-gray-400 mb-1 block" id="marker-mode-label">
             Marker mode
            </label>
            <div class="flex gap-2">
             <button class="app-control marker-mode-btn rounded" id="marker-mode-pixel">
              Pixel
             </button>
             <button class="app-control marker-mode-btn rounded" id="marker-mode-meters">
              Meters
             </button>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
       <!-- Desktop Filter Toggle - Only show on mobile -->
       <button class="hidden sm:flex items-center justify-center space-x-1 py-1 px-3 rounded-lg text-sm font-medium bg-indigo-600 hover:bg-indigo-700 transition-colors duration-150 flex-shrink-0" id="filter-toggle-btn-desktop">
        <span id="filter-toggle-text-desktop">
         Hide Filters
        </span>
        <i class="h-4 w-4" data-lucide="chevron-up" id="filter-toggle-icon-desktop">
        </i>
       </button>
      </div>
     </div>
     <!-- Row 2: Mobile Options Toggle -->
     <div class="sm:hidden flex justify-center w-full">
      <button class="flex items-center justify-center space-x-2 w-full py-2 px-4 rounded-lg text-sm font-medium bg-indigo-600 hover:bg-indigo-700 transition-colors duration-150" id="filter-toggle-btn-mobile">
       <span id="filter-toggle-text-mobile">
        Show Filters
       </span>
       <i class="h-4 w-4" data-lucide="chevron-down" id="filter-toggle-icon-mobile">
       </i>
      </button>
     </div>
     <!-- Row 3: Compact Filters (Visible by default on desktop) -->
     <div class="hidden w-full pt-2" id="filter-controls-wrapper">
      <div class="compact-filters">
       <!-- Time Filter -->
       <div class="compact-filter-group">
        <span class="compact-filter-label">
         Time:
        </span>
        <select class="app-control compact-select" id="time-select">
         <option id="time-day" value="day">
          24 hours
         </option>
         <option id="time-week" selected="" value="week">
          7 days
         </option>
         <option id="time-month" value="month">
          30 days
         </option>
        </select>
       </div>
       <!-- Magnitude Filter -->
       <div class="compact-filter-group">
        <span class="compact-filter-label">
         Mag:
        </span>
        <select class="app-control compact-select" id="mag-select">
         <option id="mag-all" value="all">
          All
         </option>
         <option value="2.5">
          2.5+
         </option>
         <option value="4.0">
          4.0+
         </option>
         <option value="5.0">
          5.0+
         </option>
         <option value="6.0">
          6.0+
         </option>
         <option value="7.0">
          7.0+
         </option>
        </select>
       </div>
       <!-- Depth Filter -->
       <div class="compact-filter-group">
        <span class="compact-filter-label">
         Depth:
        </span>
        <select class="app-control compact-select" id="depth-select">
         <option id="depth-all" value="all">
          All
         </option>
         <option id="depth-shallow" value="shallow">
          Shallow
         </option>
         <option id="depth-intermediate" value="intermediate">
          Intermediate
         </option>
         <option id="depth-deep" value="deep">
          Deep
         </option>
         <option id="depth-vdeep" value="vdeep">
          Very Deep
         </option>
        </select>
       </div>
       <!-- Country Filter -->
       <div class="compact-filter-group">
        <span class="compact-filter-label">
         Country:
        </span>
        <input class="app-control compact-input" id="country-input" placeholder="e.g., Japan" type="text"/>
       </div>
      </div>
      <div class="text-sm text-gray-300 hidden px-4 py-2 mt-3" id="country-filter-status">
      </div>
     </div>
    </div>
   </header>
   <!-- TABS -->
   <div class="bg-gray-800/50 border-b border-gray-700 flex-shrink-0">
    <div class="container mx-auto max-w-7xl px-4">
     <div class="flex space-x-4">
      <!-- 1. DASHBOARD Button -->
      <button class="tab-button py-2 px-4 text-sm font-medium border-b-2 border-indigo-500 transition-colors duration-200 text-white tooltip" data-tab="dashboard-view" id="tab-dashboard">
       <i class="inline h-4 w-4 mr-1" data-lucide="layout-dashboard">
       </i>
       Dashboard
       <span class="tooltiptext">
        Switch to Dashboard
        <span class="keyboard-shortcut">
         1
        </span>
       </span>
      </button>
      <!-- 2. Map Button -->
      <button class="tab-button py-2 px-4 text-sm font-medium border-b-2 border-transparent hover:border-indigo-500 transition-colors duration-200 text-gray-400 tooltip" data-tab="map-view" id="tab-map">
       <i class="inline h-4 w-4 mr-1" data-lucide="globe">
       </i>
       Map Explorer
       <span class="tooltiptext">
        Switch to Map Explorer
        <span class="keyboard-shortcut">
         2
        </span>
       </span>
      </button>
      <!-- 3. 3D Button -->
      <button class="tab-button py-2 px-4 text-sm font-medium border-b-2 border-transparent hover:border-indigo-500 transition-colors duration-200 text-gray-400 tooltip" data-tab="3d-view" id="tab-3d">
       <i class="inline h-4 w-4 mr-1" data-lucide="globe-2">
       </i>
       3D Globe
       <span class="tooltiptext">
        Switch to 3D Globe
        <span class="keyboard-shortcut">
         3
        </span>
       </span>
      </button>
     </div>
    </div>
   </div>
   <!-- CONTENT -->
   <div id="content-area">
    <!-- TAB 1: DASHBOARD -->
    <div class="tab-content active p-3 h-full" id="dashboard-view">
     <div class="container mx-auto max-w-7xl flex flex-col h-full">
      <!-- Dynamic Dashboard Title -->
      <div class="dashboard-header">
       <h2 class="dashboard-title" id="dashboard-title">
        Global Earthquakes - Last 7 Days
       </h2>
       <div class="dashboard-actions">
        <button class="export-btn" id="export-data-btn">
         <i class="h-4 w-4" data-lucide="download">
         </i>
         Export
        </button>
        <button class="export-btn" id="help-btn" style="background: #6366F1;">
         <i class="h-4 w-4" data-lucide="help-circle">
         </i>
         Guide
        </button>
       </div>
      </div>
      <!-- Stats Row -->
      <div class="compact-stats grid">
       <div class="compact-card card flex flex-col items-center justify-center">
        <i class="h-6 w-6 text-indigo-400 mb-1" data-lucide="activity">
        </i>
        <p class="text-sm font-medium text-gray-400" id="stat-total-title">
         Total Earthquakes
        </p>
        <p class="text-3xl font-extrabold text-white mt-1" id="total-count-stat">
         0
        </p>
       </div>
       <div class="compact-card card text-center">
        <p class="text-sm font-medium text-gray-400 mb-2" id="stat-strongest-title">
         Strongest Earthquake
        </p>
        <span class="mag-badge-large text-base" id="strongest-mag-stat">
         0.0
        </span>
        <p class="text-sm text-gray-300 mt-2 truncate" id="strongest-place-stat">
         Not available
        </p>
        <p class="text-xs text-gray-500 mt-1" id="strongest-time-stat">
         Not available
        </p>
        <p class="text-xs text-gray-500" id="strongest-depth-stat">
         Depth: Not available
        </p>
       </div>
       <div class="compact-card card text-center">
        <p class="text-sm font-medium text-gray-400 mb-2" id="stat-recent-title">
         Most Recent Earthquake
        </p>
        <p class="text-3xl font-extrabold text-green-400" id="recent-mag-stat">
         0.0
        </p>
        <p class="text-sm text-gray-300 mt-1 truncate" id="recent-place-stat">
         Not available
        </p>
        <p class="text-xs text-gray-500 mt-1" id="recent-date-stat">
         Not available
        </p>
        <p class="text-xs text-gray-500" id="recent-depth-stat">
         Depth: Not available
        </p>
        <p class="text-xs text-gray-400 italic mt-1" id="recent-time-stat">
         Not available
        </p>
       </div>
      </div>
      <!-- Alerts -->
      <div class="p-2 mb-2 text-center text-sm rounded-lg bg-indigo-600/20 text-indigo-300 border border-indigo-500 hidden" id="dashboard-message">
      </div>
      <!-- Charts Row -->
      <div class="compact-charts grid flex-grow">
       <div class="compact-card card relative flex flex-col" id="mini-map-card">
        <h3 class="text-base font-semibold mb-2 text-white" id="minimap-title">
         Distribution Map
        </h3>
        <div class="flex-grow relative">
         <div class="w-full h-full absolute rounded-md z-0" id="mini-map">
         </div>
        </div>
       </div>
       <div class="chart-container compact-chart-container flex flex-col">
        <h3 class="text-base font-semibold mb-2 text-white" id="chart-mag-title">
         Magnitude Distribution
        </h3>
        <div class="flex-grow relative">
         <canvas class="w-full h-full absolute" id="magnitudeChart">
         </canvas>
        </div>
       </div>
       <div class="chart-container compact-chart-container flex flex-col">
        <h3 class="text-base font-semibold mb-2 text-white" id="chart-depth-title">
         Depth Distribution (km)
        </h3>
        <div class="flex-grow relative">
         <canvas class="w-full h-full absolute" id="depthChart">
         </canvas>
        </div>
       </div>
      </div>
      <!-- Footer -->
      <div class="pt-2 pb-1 border-t border-gray-700 text-center text-xs text-gray-500 mt-2">
       <p>
        © 2025 Seismic Monitor. Author: Daniel Larrota R.
       </p>
       <p class="text-xs" id="footer-data-source">
       </p>
      </div>
     </div>
    </div>
    <!-- TAB 2: MAP EXPLORER -->
    <div class="tab-content relative h-full" id="map-view">
     <div id="map">
     </div>
     <!-- Legend -->
     <div class="mobile-legend-optimized md:absolute md:bottom-4 md:right-4 md:left-auto md:translate-x-0 z-[1000] rounded-lg bg-gray-800/70 shadow-lg backdrop-blur-md border border-gray-700/50 text-sm md:w-64">
      <h4 class="mb-3 font-bold text-white text-center" id="legend-mag-title">
       Magnitude Scale
      </h4>
      <!-- Size Examples -->
      <div class="legend-size-examples">
       <div class="size-example">
        <div class="size-circle" style="width: 6px; height: 6px; background-color: #E2E8F0; border: 1px solid #94A3B8;">
        </div>
        <span class="text-gray-300">
         M 2.5
        </span>
       </div>
       <div class="size-example">
        <div class="size-circle" style="width: 12px; height: 12px; background-color: #E2E8F0; border: 1px solid #94A3B8;">
        </div>
        <span class="text-gray-300">
         M 4.0
        </span>
       </div>
       <div class="size-example">
        <div class="size-circle" style="width: 18px; height: 18px; background-color: #E2E8F0; border: 1px solid #94A3B8;">
        </div>
        <span class="text-gray-300">
         M 5.5
        </span>
       </div>
       <div class="size-example">
        <div class="size-circle" style="width: 24px; height: 24px; background-color: #E2E8F0; border: 1px solid #94A3B8;">
        </div>
        <span class="text-gray-300">
         M 7.0+
        </span>
       </div>
      </div>
      <hr class="border-gray-600 my-3"/>
      <h4 class="mb-2 font-bold text-white text-center" id="legend-depth-title">
       Depth (Color)
      </h4>
      <div class="space-y-2">
       <div class="flex items-center">
        <span class="h-3 w-3 rounded-full mr-2 border border-black flex-shrink-0" style="background-color: #FFEB3B; opacity: 0.8;">
        </span>
        <span class="text-gray-300" id="depth-0-30">
         0 – 30 km (Shallow)
        </span>
       </div>
       <div class="flex items-center">
        <span class="h-3 w-3 rounded-full mr-2 border border-black flex-shrink-0" style="background-color: #FF9800; opacity: 0.8;">
        </span>
        <span class="text-gray-300" id="depth-30-100">
         30 – 100 km (Intermediate)
        </span>
       </div>
       <div class="flex items-center">
        <span class="h-3 w-3 rounded-full mr-2 border border-black flex-shrink-0" style="background-color: #2196F3; opacity: 0.8;">
        </span>
        <span class="text-gray-300" id="depth-100-300">
         100 – 300 km (Deep)
        </span>
       </div>
       <div class="flex items-center">
        <span class="h-3 w-3 rounded-full mr-2 border border-black flex-shrink-0" style="background-color: #3F51B5; opacity: 0.8;">
        </span>
        <span class="text-gray-300" id="depth-300-plus">
         +300 km (Very Deep)
        </span>
       </div>
      </div>
      <p class="mt-4 text-center text-xs text-gray-400" id="legend-source">
       Earthquake Data: USGS
      </p>
     </div>
    </div>
    <!-- Closing div for map-view -->
    <!-- TAB 3: 3D GLOBE -->
    <div class="tab-content relative h-full" id="3d-view">
     <div class="w-full h-full" id="globe-container">
     </div>
     <!-- 3D Loader -->
     <div class="three-loader hidden" id="three-loader">
      <div class="flex items-center space-x-2">
       <div class="loader-dot">
       </div>
       <div class="loader-dot">
       </div>
       <div class="loader-dot">
       </div>
      </div>
      <p class="text-sm text-gray-300 mt-2" id="three-loader-text">
       Loading 3D Visualization...
      </p>
     </div>
     <!-- 3D Overlay Info -->
     <div class="absolute top-4 left-4 z-20 bg-gray-900/70 p-3 rounded-lg border border-gray-700/50 text-sm pointer-events-none">
      <h3 class="font-bold text-white" id="three-title">
       3D Visualization
      </h3>
      <p class="text-xs text-gray-300" id="three-controls-rotate">
       Left Click: Rotate | Right Click: Pan
      </p>
      <p class="text-xs text-gray-300" id="three-controls-zoom">
       Scroll: Zoom | Height: Magnitude
      </p>
      <p class="text-xs text-green-400 mt-1" id="status-3d">
      </p>
     </div>
     <!-- Simplified 3D Legend -->
     <div class="absolute top-4 right-4 z-20 legend-3d md:w-56">
      <h4 id="legend-3d-title">
       3D Visualization Legend
      </h4>
      <div class="legend-section">
       <div class="height-info" id="legend-3d-height-info">
        Bar height represents earthquake magnitude
       </div>
      </div>
      <div class="divider">
      </div>
      <div class="legend-section">
       <span class="legend-section-title" id="legend-3d-depth-title">
        Depth (Color)
       </span>
       <div class="depth-colors">
        <div class="depth-color-item">
         <div class="depth-color" style="background-color: #FFEB3B;">
         </div>
         <span class="depth-label" id="depth-0-30">
          Shallow (0-30 km)
         </span>
        </div>
        <div class="depth-color-item">
         <div class="depth-color" style="background-color: #FF9800;">
         </div>
         <span class="depth-label" id="depth-30-100">
          Intermediate (30-100 km)
         </span>
        </div>
        <div class="depth-color-item">
         <div class="depth-color" style="background-color: #2196F3;">
         </div>
         <span class="depth-label" id="depth-100-300">
          Deep (100-300 km)
         </span>
        </div>
        <div class="depth-color-item">
         <div class="depth-color" style="background-color: #3F51B5;">
         </div>
         <span class="depth-label" id="depth-300-plus">
          Very Deep (+300 km)
         </span>
        </div>
       </div>
      </div>
      <div class="legend-note" id="legend-3d-note">
       Click on bars for earthquake details
      </div>
     </div>
    </div>
    <!-- Closing div for 3d-view -->
   </div>
   <!-- Closing div for content-area -->
   <div class="absolute bottom-4 left-1/2 -translate-x-1/2 z-[2000] hidden rounded-lg bg-red-600 px-5 py-3 text-base font-medium text-white shadow-lg" id="error-toast">
    <div class="flex items-center space-x-2">
     <i class="h-5 w-5" data-lucide="alert-triangle">
     </i>
     <span id="error-message">
     </span>
    </div>
   </div>
  </div>
  <!-- Closing div for app-container -->
  <!-- Quick Guide Modal -->
  <div class="fixed inset-0 bg-black/70 z-[10000] hidden items-center justify-center p-4" id="guide-modal">
   <div class="bg-gray-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" id="guide-card">
    <div class="p-6">
     <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold text-white" id="guide-title">
       Seismic Monitor Quick Guide
      </h3>
      <button class="text-gray-400 hover:text-white" id="close-guide">
       <i class="h-6 w-6" data-lucide="x">
       </i>
      </button>
     </div>
     <div class="space-y-4 text-gray-300">
      <div>
       <h4 class="font-semibold text-white mb-2" id="guide-keyboard-title">
        Keyboard Shortcuts
       </h4>
       <ul class="space-y-2 text-sm">
        <li class="flex items-center gap-2">
         <span class="keyboard-shortcut">
          1
         </span>
         <span id="kb-switch-dashboard">
          Switch to Dashboard
         </span>
        </li>
        <li class="flex items-center gap-2">
         <span class="keyboard-shortcut">
          2
         </span>
         <span id="kb-switch-map">
          Switch to Map Explorer
         </span>
        </li>
        <li class="flex items-center gap-2">
         <span class="keyboard-shortcut">
          3
         </span>
         <span id="kb-switch-3d">
          Switch to 3D Globe
         </span>
        </li>
        <li class="flex items-center gap-2">
         <span class="keyboard-shortcut">
          E
         </span>
         <span id="kb-export">
          Export current data
         </span>
        </li>
        <li class="flex items-center gap-2">
         <span class="keyboard-shortcut">
          F
         </span>
         <span id="kb-toggle-filters">
          Toggle filters panel
         </span>
        </li>
       </ul>
      </div>
      <div>
       <h4 class="font-semibold text-white mb-2" id="guide-understanding-title">
        Understanding the Data
       </h4>
       <p class="text-sm" id="guide-understanding-text">
        Earthquake data is sourced from the USGS Earthquake Hazards Program. The app shows earthquakes with magnitude 2.5+ from the last 24 hours, 7 days, or 30 days.
       </p>
      </div>
      <div>
       <h4 class="font-semibold text-white mb-2" id="guide-visualization-title">
        Visualization Tips
       </h4>
       <ul class="space-y-2 text-sm">
        <li id="guide-tip-size">
         • Circle size represents earthquake magnitude
        </li>
        <li id="guide-tip-color">
         • Color indicates depth (yellow=shallow, blue=deep)
        </li>
        <li id="guide-tip-3d">
         • In 3D view, bar height shows magnitude
        </li>
        <li id="guide-tip-click">
         • Click any earthquake for detailed information
        </li>
       </ul>
       <p class="text-sm mt-2" id="guide-marker-mode-desc">
        Marker mode: Pixel (screen-size) or Meters (geographic). Pixel mode matches the legend; meters shows true distances.
       </p>
      </div>
      <div>
       <h4 class="font-semibold text-white mb-2" id="guide-filtering-title">
        Filtering Options
       </h4>
       <p class="text-sm" id="guide-filtering-text">
        Use the filters to focus on specific time ranges, magnitude thresholds, depth ranges, or geographic regions.
       </p>
      </div>
     </div>
     <div class="mt-6 flex justify-end">
      <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors" id="got-it-btn">
       <span id="got-it-text">
        Got it!
       </span>
      </button>
     </div>
    </div>
   </div>
  </div>
  <!-- SCRIPTS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
  </script>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js">
  </script>
  <script src="https://unpkg.com/lucide@latest">
  </script>
  <script defer="True" src="script.js">
  </script>
 </body>
</html>
